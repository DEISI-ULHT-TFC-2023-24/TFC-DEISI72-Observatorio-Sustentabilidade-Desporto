<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <script>
        function makeLineChart(context, labels, data, lineColor, fillColor) {
            let chart = new Chart(context, {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: "Consumo total (L)",
                            pointRadius: 0,
                            pointHitRadius: 50,
                            data: data,
                            borderColor: lineColor,
                            tension: .3,
                            fill: {
                                target: 'origin',
                                above: fillColor,   // Area will be red above the origin
                                below: fillColor    // And blue below the origin
                            },
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    ]
                },
                options: {
                    title: {
                        text: "Consumo total mensal",
                        display: true
                    },
                    scales: {
                        y: {
                            suggestedMin: 50,
                            suggestedMax: 40000,
                            display: false,
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function makePieChart(context, labels, data, colors) {
            let chart = new Chart(context, {
                type: "doughnut",
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: "kWh",
                            backgroundColor: colors,
                            data: data
                        }
                    ]
                },
            });
        }

        function makeBarChart(context, labels, data, colors) {
            let chart = new Chart(context, {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: "€",
                            backgroundColor: colors,
                            data: data
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        },
                    }, plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    </script>

</head>
<body>

<div class="display">

    <div class="grid">
        <div class="display-view">
            <h1>Distribuição de Consumo Anual</h1>
            <canvas id="consumodeenergia" class="graph-view"></canvas>
        </div>
        <div class="display-view">
            <h1>Custo Energético</h1>
            <canvas id="custodeenergia" class="graph-view"></canvas>
        </div>
    </div>
</div>

<div class="display">
    <div class="grid">
        <div class="display-view">
            <h1>Custo por kWh</h1>
            <canvas id="custoconsumodeenergia" class="graph-view"></canvas>
        </div>
        <div class="display-view">
            <h1>Fáturas Energéticas</h1>
            <table>
                <tr>
                    <td>Energia</td>
                    <td>Fatura Minima kWh</td>
                    <td>Fatura Minima €</td>
                    <td>Fatura Maxima kWh</td>
                    <td>Fatura Maxima €</td>
                </tr>
                {% for a,b,c,d,e in faturas %}
                    <tr>
                        <td>{{ a }}</td>
                        <td>{{ b }}</td>
                        <td>{{ c }}</td>
                        <td>{{ d }}</td>
                        <td>{{ e }}</td>
                    </tr>
                {% endfor %}

            </table>
        </div>
    </div>
</div>


<!--<div id="ultimo-mes">
    <div class="consumo-ultimo-mes-text">
        <h2>Consumo mensal (L)</h2>
        <h1>24 200 L</h1> <p>(Ultimo Mês) </p>
        <h2> - 11,35 %</h2>
    </div>

</div>-->

<script>


    let energiaconsumo = document.getElementById("consumodeenergia").getContext("2d");

    makePieChart(energiaconsumo, {{ consumos_labels|safe }}, {{ consumos }},
        ["red", "orange", "green", "blue"])

    let energiacusto = document.getElementById("custodeenergia").getContext("2d");

    makeBarChart(energiacusto, {{ consumos_labels|safe }}, {{ custos }},
        ["yellow", "blue", "orange", "red", "green"])

    let energiacustoconsumo = document.getElementById("custoconsumodeenergia").getContext("2d");

    makeBarChart(energiacustoconsumo, {{ consumos_labels|safe }}, {{ custosconsumo }},
        ["yellow", "blue", "orange", "red", "green"])
</script>
</body>
</html>